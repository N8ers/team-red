<!DOCTYPE html>
<html>
    <head>
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;"> -->
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <title>Hello World</title>
        <style type="text/css">
        html, body { height: 100%; margin: 0; padding: 0 }
        #map-canvas { height: 100% }
        #searchInput {
            background-color: #fff;
            font-family: Roboto;
            font-size: 15px;
            font-weight: 300;
            margin-left: 12px;
            padding: 0 8px 0 8px;
            text-overflow: ellipsis;
            width: 400px;
        }
        #pac-input:focus {
            border-color: #4d90fe;
        }
        .controls {
            margin-top: 10px;
        }

        </style>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <title>Team Red</title>
        <script type="text/javascript" src="cordova.js"></script>
        <script src="data/fireData.js"></script>
        <script>
        function html(literals, ...customs) {
            let result = "";
            customs.forEach((custom, i) => {
                const lit = literals[i];
                if (Array.isArray(custom)) {
                custom = custom.join("");
                }
                result += lit;
                result += custom;
            });
            result += literals[literals.length - 1];
            return result;
        }

        function hydrantInfoTemplate(hydrantData) {
            return html`
              <div class="hydrant-info">
                  <div class="hydrant-info__head">
                    <img class="hydrant-info__img" src="${hydrantData.img}" alt="">
                    <div class="hydrant-info__data">
                      <ul class="hydrant-info__list">
                        <li>Hydrant ID: ${hydrantData.hydrant_id}</li>
                        <li>Status: ${hydrantData.status}</li>
                        <li>Top Color: ${hydrantData.top_color}</li>
                        <li>Body Color: ${hydrantData.body_color}</li>
                        <li>Type: ${hydrantData.type}</li>
                        <li>Hose Size: ${hydrantData.hose_size}</li>
                        <li>Storz: ${hydrantData.storz}</li>
                        <li>Thread Type: ${hydrantData.thread_type}</li>
                        <li>Notes: ${hydrantData.notes}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="hydrant-info__btns">
                    <button class="hydrant-info__edit-btn hydrant-info__btn">Edit</button>
                    <button class="hydrant-info__report-btn hydrant-info__btn">Report Problem</button>
                  </div>
              </div>
            `;
          }

          var activeInfoWindow = null;

        function initMap() {
            const mapEl = document.getElementById('map-canvas');
            const problemView = document.querySelector('.problemPage');

            navigator.geolocation.getCurrentPosition(function(position) {
                var lat=position.coords.latitude;
                var lang=position.coords.longitude;
                var myLatlng = new google.maps.LatLng(lat,lang);
                var mapOptions = {zoom: 13.3, center: myLatlng};
                var map = new google.maps.Map(mapEl, mapOptions);
                var marker = new google.maps.Marker({position: myLatlng, map: map});
                var searchInput = document.getElementById('searchInput');
                var searchBox = new google.maps.places.SearchBox(searchInput);
                map.controls[google.maps.ControlPosition.TOP_LEFT].push(searchInput);

                var hydrants = placeHydrants(map);

                bindEvents();
            }, onError, { timeout: 30000 });

            function onError(error) {
                alert('code: ' + error.code + '\n' +
                'message: ' + error.message + '\n');
            }

          function handleReportBtnClick() {
            mapEl.addEventListener('click', (e) => {
              if (e.target.classList.contains('hydrant-info__report-btn')) {
                problemView.classList.remove('el--hidden');
              }
            });
          }

          function handleProblemViewCloseClick() {
            problemView.addEventListener('click', (e) => {
              if (e.target.classList.contains('closebtn')) {
                problemView.classList.add('el--hidden');
              }
            });
          }

          function bindEvents() {
            handleReportBtnClick();
            handleProblemViewCloseClick();
          }
        }

        // Place hydrant markers
        function placeHydrants(map) {
            return fireData.map((hydrant, i) => {
                var image = {
                    url: 'img/hydrant.png',
                    scaledSize: new google.maps.Size(34, 34)
                };
                var position = new google.maps.LatLng(hydrant.lat, hydrant.lon);

                // create the custom hydrant marker
                var hydrantMarker = new google.maps.Marker({
                    position,
                    icon: image,
                    map,
                    title: `Hydrant ${hydrant.hydrant_id}`
                });

                // attach the info popup to the hydrant marker
                const infowindow = new google.maps.InfoWindow({
                    content: hydrantInfoTemplate(hydrant),
                    maxWidth: 400
                });

                hydrantMarker.addListener("click", function() {
                    activeInfoWindow && activeInfoWindow.close();
                    infowindow.open(map, hydrantMarker);
                    activeInfoWindow = infowindow;
                });                
            });
        }
        // UTILS END

        </script>
        <script async defer
        src="http://maps.google.com/maps/api/js?key=AIzaSyAY4RUgxwdpHRumfpCMmS7ZO1GSn-Fa6eA&callback=initMap&libraries=places" type="text/javascript"></script>
    </head>
    <body>
        <input id="searchInput" class="controls" type="text" placeholder="Search Box">
        <div id="map-canvas"></div>
        
          <!-- Submit Page -->
        
          <div class="container problemPage el--hidden">
              <button class="closebtn">X</button>
              <h3 class="reportHead">Report Hydrant Problem</h3>
              <form action="">
              <div class="insideBox">
              <label><input type="checkbox" id="radioButton">Out of Service</input></label><br>
              <label><input type="checkbox" id="radioButton">Debris in the Hydrant</input></label><br>
              <label><input type="checkbox" id="radioButton">Missing Caps & Stems</input><label></label><br>
              <label><input type="checkbox" id="radioButton">Caps on Too Tight</input></label><br>
              <label><input type="checkbox" id="radioButton">Blocked Hydrant</input></label><br>
              <label><input type="checkbox" id="radioButton">Plug Away</input></label><br>
              <label><input type="checkbox" id="radioButton">Other: 
                <input type="text" name="oname" style="width: 200px;"></input>
              </input><br>
              <div class="subbtm">
                <button>submit</button>
              </div>
              </div>
            </form>
          </div>

        </main> 
        <!-- <script type="text/javascript" src="js/index.js"></script> -->
    </body>
</html>
